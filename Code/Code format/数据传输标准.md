# 玖天数据传输标准 #
>## 数据传输原则 ##

#### 传输过程减少对产品侵入性 ####
* 对数据内容的更改
* 对文件名称的更改
* 对目录结构的更改

#### 传输过程尽量少的占用带宽和磁盘空间 ####
* 传输过程中压缩数据
* 减少中间环节的存储

#### 服务器按职工作 ####
* 各服务器按照其职能提供服务，不越级越权（例如分发服务器在传输系统中仅作分发，不直接对接云服务器或用户服务器）

#### 目录结构统一性 ####
* 各个项目待传输产品和数据统一遵循一个目录结构规范
* 所设计的目录结构规范要能兼容各个项目的产品
* 目录分类可扩展，但在各个项目中应该保持一致（该项需与业务人员沟通）

>## 数据传输规范 ##

#### 总体流程 ####


#### 传输流程 ####
1. 生产者按照标准命名规范和目录规范生成产品（数据）到指定目录
2. 使用rsync或ftp发送数据到分发服务器，之后将数据删除
3. 数据分发服务器备份原始的数据（此处保证留有备份数据，其他环节不做备份）到备份服务器
4. 数据分发服务器规范化目录结构及产品命名，然后使用rsync或ftp分发数据（数据在单个服务器内流转时尽可能使用mv命令，来减少对磁盘IO的资源消耗），发送后的数据移动至其他目录，保留X天
5. 数据再加工节点对数据进行再次加工后，将数据发回分发服务器（再加工节点不保留原料与产品）
6. 信息中心服务器所有数据发送完后删除，不做保留
7. VPN专线服务器所有数据发送完后删除，不做保留
8. 云服务器提供服务时保留数据，仅做传输时不保留数据

#### 目录规范 ####
* 根目录为项目名称缩写（参照命名规范中对项目名的编码）
* 一级目录为各个产品类型分类（分类可按照预报系统来分，也可以直接通分三类：预报，预警，实况等，此处需要讨论）
* 二级目录
* 三级目录按照自然日对产品进行分类（时间均按照北京时来划分）
* 四级目录存储产品文件（文件名中涉及时间标明北京时世界时）

#### rsync传输方式 ####
* 各个环节完成传输后移走或删除完成传输的文件
* 生产环节中产生的中间文件不要放到传输目录（即传输目录在任何时间都只能放最终产品）
* 如果生成程序是由脚本驱动的，则需要在脚本中添加rsync同步策略
* 传输过程中每项目一账户

#### FTP传输方式 ####
* 各个环节完成传输后移走或删除完成传输的文件
* 生产环节中产生的中间文件不要放到传输目录（即传输目录在任何时间都只能放最终产品）
* 如果生成程序是由脚本驱动的，则需要在脚本中添加ftp同步策略
* 传输过程中每项目一账户

#### 应急情况手动补发 ####
* 从备份服务器拿出原始数据直接传给分发服务器，后序环节各个服务器自动处理无需人为干预

#### 删除策略 ####
* 数据定期清除只在分发服务器和备份服务器设置，（如有需求在云服务器上也进行清除设置）其他服务器不做定期删除
* 传输环节各服务器均在发送成功后删除已发送的数据，不涉及定时清除策略

>## 规范变更流程 ##

* 如规范有变更需求，需先联系相关技术人员讨论并说明情况，而后提交流程进行审批变更
